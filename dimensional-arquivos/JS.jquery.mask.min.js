!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery||window.Zepto)}(function(t){t.fn.mask=function(e,a){return this.unmask(),this.each(function(){t(this).data("mask",new function(e,a,n){var r,o,s=this;e=t(e),a="function"==typeof a?a(e.val(),void 0,e,n):a,s.init=function(){n=n||{},s.byPassKeys=[9,16,17,18,36,37,38,39,40,91],s.translation={0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}},s.translation=t.extend({},s.translation,n.translation),s=t.extend(!0,{},s,n),o=i.getRegexMask(),e.each(function(){!1!==n.maxlength&&e.attr("maxlength",a.length),n.placeholder&&e.attr("placeholder",n.placeholder),e.attr("autocomplete","off"),i.destroyEvents(),i.events();var t=i.getCaret();i.val(i.getMasked()),i.setCaret(t+i.getMaskCharactersBeforeCount(t,!0))})};var i={getCaret:function(){var t;t=0;var a=e.get(0),n=document.selection;return a=a.selectionStart,n&&!~navigator.appVersion.indexOf("MSIE 10")?((t=n.createRange()).moveStart("character",e.is("input")?-e.val().length:-e.text().length),t=t.text.length):(a||"0"===a)&&(t=a),t},setCaret:function(t){var a;e.is(":focus")&&((a=e.get(0)).setSelectionRange?a.setSelectionRange(t,t):a.createTextRange&&((a=a.createTextRange()).collapse(!0),a.moveEnd("character",t),a.moveStart("character",t),a.select()))},events:function(){e.on("keydown.mask",function(){r=i.val()}),e.on("keyup.mask",i.behaviour),e.on("paste.mask drop.mask",function(){setTimeout(function(){e.keydown().keyup()},100)}),e.on("change.mask",function(){e.data("changeCalled",!0)}),e.on("blur.mask",function(e){(e=t(e.target)).prop("defaultValue")!==e.val()&&(e.prop("defaultValue",e.val()),e.data("changeCalled")||e.trigger("change")),e.data("changeCalled",!1)}),e.on("focusout.mask",function(){n.clearIfNotMatch&&!o.test(i.val())&&i.val("")})},getRegexMask:function(){var t,e,n,r,o,i=[];for(o in a)(t=s.translation[a[o]])?(e=t.pattern.toString().replace(/.{1}$|^.{1}/g,""),n=t.optional,(t=t.recursive)?(i.push(a[o]),r={digit:a[o],pattern:e}):i.push(n||t?e+"?":e)):i.push("\\"+a[o]);return i=i.join(""),r&&(i=i.replace(RegExp("("+r.digit+"(.*"+r.digit+")?)"),"($1)?").replace(RegExp(r.digit,"g"),r.pattern)),RegExp(i)},destroyEvents:function(){e.off("keydown.mask keyup.mask paste.mask drop.mask change.mask blur.mask focusout.mask").removeData("changeCalled")},val:function(t){var a=e.is("input");return 0<arguments.length?a?e.val(t):e.text(t):a?e.val():e.text()},getMaskCharactersBeforeCount:function(t,e){for(var n=0,r=0,o=a.length;r<o&&r<t;r++)s.translation[a.charAt(r)]||(t=e?t+1:t,n++);return n},determineCaretPos:function(t,e,n,r){return s.translation[a.charAt(Math.min(t-1,a.length-1))]?Math.min(t+n-e-r,n):i.determineCaretPos(t+1,e,n,r)},behaviour:function(e){var a=(e=e||window.event).keyCode||e.which;if(-1===t.inArray(a,s.byPassKeys)){var n=i.getCaret(),r=i.val(),o=r.length,c=n<o,l=i.getMasked(),u=l.length,h=i.getMaskCharactersBeforeCount(u-1)-i.getMaskCharactersBeforeCount(o-1);return l!==r&&i.val(l),!c||65===a&&e.ctrlKey||(8!==a&&46!==a&&(n=i.determineCaretPos(n,o,u,h)),i.setCaret(n)),i.callbacks(e)}},getMasked:function(t){var e,r,o=[],c=i.val(),l=0,u=a.length,h=0,f=c.length,g=1,d="push",v=-1;for(n.reverse?(d="unshift",g=-1,e=0,l=u-1,h=f-1,r=function(){return-1<l&&-1<h}):(e=u-1,r=function(){return l<u&&h<f});r();){var m=a.charAt(l),p=c.charAt(h),k=s.translation[m];k?(p.match(k.pattern)?(o[d](p),k.recursive&&(-1===v?v=l:l===e&&(l=v-g),e===v&&(l-=g)),l+=g):k.optional&&(l+=g,h-=g),h+=g):(t||o[d](m),p===m&&(h+=g),l+=g)}return t=a.charAt(e),u!==f+1||s.translation[t]||o.push(t),o.join("")},callbacks:function(t){var o=i.val(),s=i.val()!==r;!0===s&&"function"==typeof n.onChange&&n.onChange(o,t,e,n),!0===s&&"function"==typeof n.onKeyPress&&n.onKeyPress(o,t,e,n),"function"==typeof n.onComplete&&o.length===a.length&&n.onComplete(o,t,e,n)}};s.remove=function(){var t=i.getCaret(),e=i.getMaskCharactersBeforeCount(t);i.destroyEvents(),i.val(s.getCleanVal()).removeAttr("maxlength"),i.setCaret(t-e)},s.getCleanVal=function(){return i.getMasked(!0)},s.init()}(this,e,a))})},t.fn.unmask=function(){return this.each(function(){try{t(this).data("mask").remove()}catch(t){}})},t.fn.cleanVal=function(){return t(this).data("mask").getCleanVal()},t("*[data-mask]").each(function(){var e=t(this),a={};"true"===e.attr("data-mask-reverse")&&(a.reverse=!0),"false"===e.attr("data-mask-maxlength")&&(a.maxlength=!1),"true"===e.attr("data-mask-clearifnotmatch")&&(a.clearIfNotMatch=!0),e.mask(e.attr("data-mask"),a)})});